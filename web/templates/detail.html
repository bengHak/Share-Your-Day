{% extends "base.html" %} {% load static %}{% block contents %}

<br />
<br />
{% comment %} rgba(248, 131, 121, 0.15) {% endcomment %}
<div class="jumbotron" style="background: rgba(0,0,0,0)">
  {% comment %} style="background: linear-gradient(#ffffff, rgba(248, 131, 121, 0.15), #ffffff) !important;">
  {% endcomment %}
  <div class="container">
    <div class="row">
      <div class="container col-md-8">
        <img src="{{ fund_detail.image_url.url }}" alt="{{ title }}" width="100%" style="border-radius: 20px !important;" />
        <br>
      </div>
      <div class="container col-md-4 align-self-center">
        <div class="media-body">
          <h2 class="mt-0">{{ fund_detail.title }}</h2>
          <h5 href="#">기부자명(기관명, 링크로 연결)</h5>
          <div style="font-weight:bold;">
            <p>기부 시작일 ~ 기부 마감일</p>
            <p>목표 금액 : {{fund_detail.goal}}원</p>
            <p>현재 모금액 : {{fund_detail.current_fund}}원</p>
            <p>test view : {{fund_detail.hit}}</p>
          </div>
          <div class="row justify-content-start">

            <div class="col-md-12">
              {% comment %} <form action="{% url 'post_like' fund_detail.fund_id%}" method="POST" style="display:inline;"> {% endcomment %}
                {% comment %} {% csrf_token %} {% endcomment %}
                <button id="like" type="submit" value="like" class="btn btn-primary btn-sm" name="{{fund_detail.fund_id}}">
                  {{fund_detail.like}} 좋아요
                </button>
              {% comment %} </form> {% endcomment %}
              <button type="button" id="kakao-link-btn" class="btn btn-primary btn-sm" href="javascript:;">
                카톡 공유
              </button>
              <button type="button" class="btn btn-primary btn-sm">
                URL 복사
              </button>
            </div>
          </div>

          <div class="row justify-content-start mt-2">
            <div class="col-md-12">
              <button type="button" class="btn btn-warning" style="width:100% !important;"
                onclick="location.href='{% url 'payment' %}'">
                기부하기
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12 mt-3 mb-1">
        <div class="progress" style="height: 30px; width: 100%">
          <div class="progress-bar bg-warning" role="progressbar"
            style="width: {% widthratio fund_detail.current_fund fund_detail.goal 100 %}%; color: black;"
            aria-valuenow="{% widthratio fund_detail.current_fund fund_detail.goal 100 %}" aria-valuemin="0"
            aria-valuemax="100">
            {% widthratio fund_detail.current_fund fund_detail.goal 100 %}% ({{fund_detail.current_fund}}원)
          </div>

        </div>
      </div>
      <div class="col-md-6 mt-4">
        <div class="jumbotron">
          {{ fund_detail.content }}
        </div>
      </div>

      <div class="col-md-6 mt-4">
        <div class="jumbotron">
          <h4>기부자 목록</h4>
          {% for giver in fund_detail.givers %}
          <div class="row">
            <div class="col-md-3 col-sm-12">
              {{giver.nickname}}
            </div>
            <div class="progress col-md-9 col-sm-12" style="height: 20px; width: 100%">
              <div class="progress-bar bg-warning" role="progressbar"
                style="width: {% widthratio fund_detail.current_fund fund_detail.current_fund 100 %}%; color: black;"
                aria-valuenow="{% widthratio fund_detail.current_fund fund_detail.current_fund 100 %}" aria-valuemin="0"
                aria-valuemax="100">
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <br /><br />

<script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
<script type='text/javascript'>
  //<![CDATA[
    // // 사용할 앱의 JavaScript 키를 설정해 주세요.
    Kakao.init('c2eac2e45e9b4539eab1b1ecbeaf492a');
    // // 카카오링크 버튼을 생성합니다. 처음 한번만 호출하면 됩니다.
    Kakao.Link.createDefaultButton({
      container: '#kakao-link-btn',
      objectType: 'feed',
      content: {
        title: '딸기 치즈 케익',
        description: '#케익 #딸기 #삼평동 #카페 #분위기 #소개팅',
        imageUrl: 'http://mud-kage.kakao.co.kr/dn/Q2iNx/btqgeRgV54P/VLdBs9cvyn8BJXB3o7N8UK/kakaolink40_original.png',
        link: {
          mobileWebUrl: 'https://developers.kakao.com',
          webUrl: 'https://developers.kakao.com'
        }
      },
      social: {
        likeCount: 286,
        commentCount: 45,
        sharedCount: 845
      },
      buttons: [
        {
          title: '웹으로 보기',
          link: {
            mobileWebUrl: 'https://developers.kakao.com',
            webUrl: 'https://developers.kakao.com'
          }
        },
        {
          title: '앱으로 보기',
          link: {
            mobileWebUrl: 'https://developers.kakao.com',
            webUrl: 'https://developers.kakao.com'
          }
        }
      ]
    });
  //]]>
  </script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script  type="text/javascript">

// 좋아요 버튼 처리
// 버튼 클릭 > ajax통신 (like url로 전달) > views의 like 메소드에서 리턴하는 값 전달받기 > 성공시 콜백 호출
$('#like').click(function(){
  var pk = $(this).attr('name') // 클릭한 요소의 attribute 중 name의 값을 가져온다.
  $.ajax({
      type: "POST", // 데이터를 전송하는 방법을 지정한다.
      url: "{% url 'like' %}", // 통신할 url을 지정한다.
      data: {'pk': pk, 'csrfmiddlewaretoken': '{{ csrf_token }}'}, // 서버로 데이터를 전송할 때 이 옵션을 사용한다.
      dataType: "json", // 서버측에서 전송한 데이터를 어떤 형식의 데이터로서 해석할 것인가를 지정한다. 없으면 알아서 판단한다.
      // 서버측에서 전송한 데이터 views.py like 메소드
      // context = {'likes_count' : memo.total_likes, 'message' : message}
      // json.dump(context)를 통해서 json 형식으로 전달된다.

      success: function(response){ // 성공했을 때 호출할 콜백을 지정한다.
        id = $(this).attr('name')
        $('#count'+ pk).html("count : "+ response.likes_count);
        //alert(response.message);
        //alert("좋아요수 :" + response.likes_count);
        $('#like').text(response.likes_count+" 좋아요")
      },
      error:function(request,status,error){
        //alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
      }
  });
})

</script>

  {% endblock contents %}